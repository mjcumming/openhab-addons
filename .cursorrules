REFERNCE API https://github.com/kk7ds/somecomfort

# HoneywellTCC OpenHAB Binding Development Guide

## Overview
This guide details the implementation of a binding for Honeywell Total Comfort Control (TCC) thermostats in OpenHAB. The implementation must follow the OpenHAB development guidelines and patterns while exactly matching the HTTP behavior of the reference Python implementation.

**IMPORTANT: Follow existing OpenHAB design patterns. Reference existing bindings in the OpenHAB codebase for implementation guidance. Consistency with OpenHAB conventions is critical.**

# HoneywellTCC OpenHAB Binding Development Guide

## Overview
This guide details the implementation of a binding for Honeywell Total Comfort Control (TCC) thermostats in OpenHAB. The implementation must follow the OpenHAB development guidelines and patterns while exactly matching the HTTP behavior of the reference Python implementation: https://github.com/kk7ds/somecomfort

**IMPORTANT: Follow existing OpenHAB design patterns. Reference existing bindings in the OpenHAB codebase for implementation guidance.**

## Project Structure
```
org.openhab.binding.honeywelltcc/
├── README.md                              // Binding documentation
├── pom.xml                                // Maven build file
├── src/main/java/org/openhab/binding/honeywelltcc/
│   └── internal/
│       ├── HoneywellTCCBindingConstants.java
│       ├── HoneywellTCCHandlerFactory.java
│       ├── handler/
│       │   ├── HoneywellTCCBridgeHandler.java
│       │   └── HoneywellTCCThermostatHandler.java
│       └── client/                        // API client implementation
│           └── TCCClient.java            // Based on Python implementation
└── src/main/resources/
    └── OH-INF/
        ├── binding/
        │   └── binding.xml               // Binding definition
        └── thing/
            └── thing-types.xml           // Thing type definitions
```

## Core Files Implementation

### 1. pom.xml
```xml
<?xml version="1.0" encoding="UTF-8"?>
<project xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns="http://maven.apache.org/POM/4.0.0"
    xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd">

  <modelVersion>4.0.0</modelVersion>

  <parent>
    <groupId>org.openhab.addons.bundles</groupId>
    <artifactId>org.openhab.addons.reactor.bundles</artifactId>
    <version>4.1.0-SNAPSHOT</version>
  </parent>

  <artifactId>org.openhab.binding.honeywelltcc</artifactId>

  <name>openHAB Add-ons :: Bundles :: HoneywellTCC Binding</name>

  <dependencies>
    <dependency>
      <groupId>com.google.code.gson</groupId>
      <artifactId>gson</artifactId>
      <version>${gson.version}</version>
      <scope>provided</scope>
    </dependency>
  </dependencies>
</project>
```

### 2. binding.xml
```xml
<?xml version="1.0" encoding="UTF-8"?>
<binding:binding id="honeywelltcc" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xmlns:binding="https://openhab.org/schemas/binding/v1.0.0"
    xsi:schemaLocation="https://openhab.org/schemas/binding/v1.0.0 https://openhab.org/schemas/binding-1.0.0.xsd">

  <name>HoneywellTCC Binding</name>
  <description>Controls Honeywell Total Comfort Control thermostats</description>
  <author>Your Name</author>

</binding:binding>
```

### 3. thing-types.xml
```xml
<?xml version="1.0" encoding="UTF-8"?>
<thing:thing-descriptions bindingId="honeywelltcc"
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xmlns:thing="https://openhab.org/schemas/thing-description/v1.0.0"
    xsi:schemaLocation="https://openhab.org/schemas/thing-description/v1.0.0 https://openhab.org/schemas/thing-description-1.0.0.xsd">

    <!-- Bridge -->
    <bridge-type id="bridge">
        <label>Honeywell TCC Account</label>
        <description>Honeywell Total Comfort Control account connection</description>

        <config-description>
            <parameter name="username" type="text" required="true">
                <context>username</context>
                <label>Username</label>
                <description>Honeywell TCC account username</description>
            </parameter>
            <parameter name="password" type="text" required="true">
                <context>password</context>
                <label>Password</label>
                <description>Honeywell TCC account password</description>
            </parameter>
            <parameter name="refresh" type="integer" min="60" unit="s">
                <label>Refresh Interval</label>
                <description>Time between device updates (minimum 60 seconds)</description>
                <default>300</default>
            </parameter>
        </config-description>
    </bridge-type>

    <!-- Thermostat -->
    <thing-type id="thermostat">
        <supported-bridge-type-refs>
            <bridge-type-ref id="bridge"/>
        </supported-bridge-type-refs>

        <label>Honeywell Thermostat</label>
        <description>Honeywell TCC Thermostat</description>

        <channels>
            <channel id="temperature" typeId="system.temperature">
                <label>Temperature</label>
                <description>Current temperature reading</description>
            </channel>
            <channel id="setpointHeat" typeId="system.temperature">
                <label>Heat Setpoint</label>
                <description>Target heating temperature</description>
            </channel>
            <channel id="setpointCool" typeId="system.temperature">
                <label>Cool Setpoint</label>
                <description>Target cooling temperature</description>
            </channel>
            <channel id="humidity" typeId="system.humidity">
                <label>Indoor Humidity</label>
                <description>Current indoor humidity</description>
            </channel>
            <channel id="outdoorTemperature" typeId="system.temperature">
                <label>Outdoor Temperature</label>
                <description>Current outdoor temperature</description>
            </channel>
            <channel id="outdoorHumidity" typeId="system.humidity">
                <label>Outdoor Humidity</label>
                <description>Current outdoor humidity</description>
            </channel>
            <channel id="fanMode" typeId="fanMode"/>
            <channel id="systemMode" typeId="systemMode"/>
            <channel id="holdMode" typeId="holdMode"/>
        </channels>

        <config-description>
            <parameter name="deviceId" type="text" required="true">
                <label>Device ID</label>
                <description>The ID of the thermostat device</description>
            </parameter>
            <parameter name="locationId" type="text" required="true">
                <label>Location ID</label>
                <description>The ID of the location containing the thermostat</description>
            </parameter>
        </config-description>
    </thing-type>

    <!-- Channel Types -->
    <channel-type id="fanMode">
        <item-type>String</item-type>
        <label>Fan Mode</label>
        <description>Fan operation mode</description>
        <state>
            <options>
                <option value="auto">Auto</option>
                <option value="on">On</option>
                <option value="circulate">Circulate</option>
                <option value="follow schedule">Follow Schedule</option>
            </options>
        </state>
    </channel-type>

    <channel-type id="systemMode">
        <item-type>String</item-type>
        <label>System Mode</label>
        <description>System operation mode</description>
        <state>
            <options>
                <option value="emheat">Emergency Heat</option>
                <option value="heat">Heat</option>
                <option value="off">Off</option>
                <option value="cool">Cool</option>
                <option value="auto">Auto</option>
            </options>
        </state>
    </channel-type>

    <channel-type id="holdMode">
        <item-type>String</item-type>
        <label>Hold Mode</label>
        <description>Temperature hold mode</description>
        <state>
            <options>
                <option value="schedule">Follow Schedule</option>
                <option value="temporary">Temporary Hold</option>
                <option value="permanent">Permanent Hold</option>
            </options>
        </state>
    </channel-type>
</thing:thing-descriptions>
```

### 4. HoneywellTCCBindingConstants.java
```java
/**
 * Copyright (c) 2010-2024 Contributors to the openHAB project
 *
 * See the NOTICE file distributed with this work for additional information
 * regarding copyright ownership. Licensed under the EPL 2.0.
 */
package org.openhab.binding.honeywelltcc.internal;

import org.eclipse.jdt.annotation.NonNullByDefault;
import org.openhab.core.thing.ThingTypeUID;

/**
 * The {@link HoneywellTCCBindingConstants} class defines common constants used across the binding.
 *
 * @author Your Name - Initial contribution
 */
@NonNullByDefault
public class HoneywellTCCBindingConstants {

    public static final String BINDING_ID = "honeywelltcc";

    // Bridge & Thing Types
    public static final ThingTypeUID THING_TYPE_BRIDGE = new ThingTypeUID(BINDING_ID, "bridge");
    public static final ThingTypeUID THING_TYPE_THERMOSTAT = new ThingTypeUID(BINDING_ID, "thermostat");

    // Channel IDs
    public static final String CHANNEL_TEMPERATURE = "temperature";
    public static final String CHANNEL_SETPOINT_HEAT = "setpointHeat";
    public static final String CHANNEL_SETPOINT_COOL = "setpointCool";
    public static final String CHANNEL_HUMIDITY = "humidity";
    public static final String CHANNEL_OUTDOOR_TEMPERATURE = "outdoorTemperature";
    public static final String CHANNEL_OUTDOOR_HUMIDITY = "outdoorHumidity";
    public static final String CHANNEL_FAN_MODE = "fanMode";
    public static final String CHANNEL_SYSTEM_MODE = "systemMode";
    public static final String CHANNEL_HOLD_MODE = "holdMode";

    // Configuration parameters
    public static final String CONFIG_USERNAME = "username";
    public static final String CONFIG_PASSWORD = "password";
    public static final String CONFIG_REFRESH = "refresh";
    public static final String CONFIG_DEVICE_ID = "deviceId";
    public static final String CONFIG_LOCATION_ID = "locationId";

    // Match Python implementation constants
    public static final String[] FAN_MODES = {"auto", "on", "circulate", "follow schedule"};
    public static final String[] SYSTEM_MODES = {"emheat", "heat", "off", "cool", "auto"};
    public static final String[] HOLD_TYPES = {"schedule", "temporary", "permanent"};
    public static final String[] EQUIPMENT_OUTPUT_STATUS = {"off/fan", "heat", "cool"};
}
```


## Error Handling
Implement specific exception handling for:
- Authentication failures
- Rate limiting
- Network errors
- Session timeouts
- Invalid device responses

## Testing Requirements
1. Unit tests for all components
2. Integration tests for HTTP client
3. Mocked device responses
4. Error condition handling
5. State machine testing

## Development Guidelines

**Follow OpenHAB Patterns:**
- Use standard OpenHAB foundation classes
- Implement proper disposal in dispose() methods
- Follow OpenHAB logging conventions
- Use standard OpenHAB configuration patterns
- Reference existing bindings for implementation patterns

**Critical Implementation Notes:**
1. Exactly match the Python implementation's HTTP behavior
2. Implement proper rate limiting
3. Handle all temperature values in Fahrenheit internally
4. Validate hold times for 15-minute boundaries
5. Handle partial device data gracefully
6. Ensure thread safety in all components
7. Implement proper resource cleanup
8. Follow OpenHAB null annotation patterns
9. Use appropriate OpenHAB type systems

## API Reference
Key endpoints:
- Authentication: `/portal/Account/LogOn`
- Location List: `/portal/Location/GetLocationListData`
- Device Data: `/portal/Device/CheckDataSession/{deviceId}`
- Settings Update: `/portal/Device/SubmitControlScreenChanges`

## References
- OpenHAB Developer Guide: https://www.openhab.org/docs/developer/
- OpenHAB Guidelines: https://www.openhab.org/docs/developer/guidelines.html
- Binding Development: https://www.openhab.org/docs/developer/bindings/
- Add-ons: https://www.openhab.org/docs/developer/addons/